!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4ec8393d-5cda-4b32-aa88-d53d1de7112b",e._sentryDebugIdIdentifier="sentry-dbid-4ec8393d-5cda-4b32-aa88-d53d1de7112b")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[311],{22277:(e,t,i)=>{i.d(t,{OS:()=>r,d$:()=>A});let r="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class n{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){let{color:i,piece:r,from:n,to:l,flags:a,captured:h,promotion:u}=t,f=k(n),d=k(l);for(let n in this.color=i,this.piece=r,this.from=f,this.to=d,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=f+d,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="",o)o[n]&a&&(this.flags+=s[n]);h&&(this.captured=h),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(s.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(s.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(s.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(s.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(s.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(s.BIG_PAWN)>-1}}let s={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},o={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},l={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},a={...l,WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},h={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},u={b:[16,32,17,15],w:[-16,-32,-17,-15]},f={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],_=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],c={p:1,n:2,b:4,r:8,q:16,k:32},p=["n","b","r","q"],g={k:o.KSIDE_CASTLE,q:o.QSIDE_CASTLE},m={w:[{square:h.a1,flag:o.QSIDE_CASTLE},{square:h.h1,flag:o.KSIDE_CASTLE}],b:[{square:h.a8,flag:o.QSIDE_CASTLE},{square:h.h8,flag:o.KSIDE_CASTLE}]},b={b:1,w:6},v=["1-0","0-1","1/2-1/2","*"];function E(e){return -1!=="0123456789".indexOf(e)}function k(e){let t=15&e,i=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function S(e){return"w"===e?"b":"w"}function w(e,t,i,r,n,s,l=o.NORMAL){let a=r>>4;if("p"===n&&(7===a||0===a))for(let a=0;a<p.length;a++){let h=p[a];e.push({color:t,from:i,to:r,piece:n,captured:s,promotion:h,flags:l|o.PROMOTION})}else e.push({color:t,from:i,to:r,piece:n,captured:s,flags:l})}function C(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}function y(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function I(e){return e.split(" ").slice(0,4).join(" ")}class A{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(e=r,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...a},this._positionCount={},this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6&&(e=r.concat(["-","-","0","1"].slice(-(6-r.length))).join(" ")),r=e.split(/\s+/),!t){let{ok:t,error:i}=function(e){let t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let i=parseInt(t[5],10);if(isNaN(i)||i<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let n=t[0].split("/");if(8!==n.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<n.length;e++){let t=0,i=!1;for(let r=0;r<n[e].length;r++)if(E(n[e][r])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(n[e][r],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[e][r]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,i=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:e,regex:i}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!i.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(i)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(n[0]+n[7]).some(e=>"P"===e.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw Error(i)}let n=r[0],s=0;this.clear({preserveHeaders:i});for(let e=0;e<n.length;e++){let t=n.charAt(e);if("/"===t)s+=8;else if(E(t))s+=parseInt(t,10);else{let e=t<"a"?"w":"b";this._put({type:t.toLowerCase(),color:e},k(s)),s++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=o.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=o.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=o.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=o.QSIDE_CASTLE),this._epSquare="-"===r[3]?-1:h[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){let e=0,t="";for(let i=h.a8;i<=h.h1;i++){if(this._board[i]){e>0&&(t+=e,e=0);let{color:r,type:n}=this._board[i];t+="w"===r?n.toUpperCase():n.toLowerCase()}else e++;i+1&136&&(e>0&&(t+=e),i!==h.h1&&(t+="/"),e=0,i+=8)}let i="";this._castling.w&o.KSIDE_CASTLE&&(i+="K"),this._castling.w&o.QSIDE_CASTLE&&(i+="Q"),this._castling.b&o.KSIDE_CASTLE&&(i+="k"),this._castling.b&o.QSIDE_CASTLE&&(i+="q"),i=i||"-";let r="-";if(-1!==this._epSquare){let e=this._epSquare+("w"===this._turn?16:-16);for(let t of[e+1,e-1]){if(136&t)continue;let e=this._turn;if(this._board[t]?.color===e&&this._board[t]?.type==="p"){this._makeMove({color:e,from:t,to:this._epSquare,piece:"p",captured:"p",flags:o.EP_CAPTURE});let i=!this._isKingAttacked(e);if(this._undoMove(),i){r=k(this._epSquare);break}}}}return[t,this._turn,i,r,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==r?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(r)}get(e){return this._board[h[e]]}findPiece(e){let t=[];for(let i=h.a8;i<=h.h1;i++){if(136&i){i+=7;continue}this._board[i]&&this._board[i]?.color===e.color&&this._board[i].color===e.color&&this._board[i].type===e.type&&t.push(k(i))}return t}put({type:e,color:t},i){return!!this._put({type:e,color:t},i)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_put({type:e,color:t},i){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase())||!(i in h))return!1;let r=h[i];if("k"==e&&-1!=this._kings[t]&&this._kings[t]!=r)return!1;let n=this._board[r];return n&&"k"===n.type&&(this._kings[n.color]=-1),this._board[r]={type:e,color:t},"k"===e&&(this._kings[t]=r),!0}remove(e){let t=this.get(e);return delete this._board[h[e]],t&&"k"===t.type&&(this._kings[t.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){let e=this._board[h.e1]?.type==="k"&&this._board[h.e1]?.color==="w",t=this._board[h.e8]?.type==="k"&&this._board[h.e8]?.color==="b";e&&this._board[h.a1]?.type==="r"&&this._board[h.a1]?.color==="w"||(this._castling.w&=~o.QSIDE_CASTLE),e&&this._board[h.h1]?.type==="r"&&this._board[h.h1]?.color==="w"||(this._castling.w&=~o.KSIDE_CASTLE),t&&this._board[h.a8]?.type==="r"&&this._board[h.a8]?.color==="b"||(this._castling.b&=~o.QSIDE_CASTLE),t&&this._board[h.h8]?.type==="r"&&this._board[h.h8]?.color==="b"||(this._castling.b&=~o.KSIDE_CASTLE)}_updateEnPassantSquare(){if(-1===this._epSquare)return;let e=this._epSquare+("w"===this._turn?-16:16),t=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[e]||null!==this._board[this._epSquare]||this._board[t]?.color!==S(this._turn)||this._board[t]?.type!=="p"){this._epSquare=-1;return}[t+1,t-1].some(e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type==="p")||(this._epSquare=-1)}_attacked(e,t,i){let r=[];for(let n=h.a8;n<=h.h1;n++){if(136&n){n+=7;continue}if(void 0===this._board[n]||this._board[n].color!==e)continue;let s=this._board[n],o=n-t;if(0===o)continue;let l=o+119;if(d[l]&c[s.type]){if("p"===s.type){if(o>0&&"w"===s.color||o<=0&&"b"===s.color){if(!i)return!0;r.push(k(n))}continue}if("n"===s.type||"k"===s.type){if(!i)return!0;r.push(k(n));continue}let e=_[l],a=n+e,h=!1;for(;a!==t;){if(null!=this._board[a]){h=!0;break}a+=e}if(!h){if(!i)return!0;r.push(k(n));continue}}}return!!i&&r}attackers(e,t){return t?this._attacked(t,h[e],!0):this._attacked(this._turn,h[e],!0)}_isKingAttacked(e){let t=this._kings[e];return -1!==t&&this._attacked(S(e),t)}isAttacked(e,t){return this._attacked(t,h[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],i=0,r=0;for(let n=h.a8;n<=h.h1;n++){if(r=(r+1)%2,136&n){n+=7;continue}let s=this._board[n];s&&(e[s.type]=s.type in e?e[s.type]+1:1,"b"===s.type&&t.push(r),i++)}if(2===i||3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){let e=0,i=t.length;for(let r=0;r<i;r++)e+=t[r];if(0===e||e===i)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:i}={}){let r=this._moves({square:t,piece:i});return e?r.map(e=>new n(this,e)):r.map(e=>this._moveToSan(e,r))}_moves({legal:e=!0,piece:t,square:i}={}){let r=i?i.toLowerCase():void 0,n=t?.toLowerCase(),s=[],l=this._turn,a=S(l),d=h.a8,_=h.h1,c=!1;if(r){if(!(r in h))return[];d=_=h[r],c=!0}for(let e=d;e<=_;e++){let t;if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===a)continue;let{type:i}=this._board[e];if("p"===i){if(n&&n!==i)continue;t=e+u[l][0],!this._board[t]&&(w(s,l,e,t,"p"),t=e+u[l][1],b[l]===e>>4&&!this._board[t]&&w(s,l,e,t,"p",void 0,o.BIG_PAWN));for(let i=2;i<4;i++)136&(t=e+u[l][i])||(this._board[t]?.color===a?w(s,l,e,t,"p",this._board[t].type,o.CAPTURE):t===this._epSquare&&w(s,l,e,t,"p","p",o.EP_CAPTURE))}else{if(n&&n!==i)continue;for(let r=0,n=f[i].length;r<n;r++){let n=f[i][r];for(t=e;!(136&(t+=n));){if(this._board[t]){if(this._board[t].color===l)break;w(s,l,e,t,i,this._board[t].type,o.CAPTURE);break}if(w(s,l,e,t,i),"n"===i||"k"===i)break}}}}if((void 0===n||"k"===n)&&(!c||_===this._kings[l])){if(this._castling[l]&o.KSIDE_CASTLE){let e=this._kings[l],t=e+2;this._board[e+1]||this._board[t]||this._attacked(a,this._kings[l])||this._attacked(a,e+1)||this._attacked(a,t)||w(s,l,this._kings[l],t,"k",void 0,o.KSIDE_CASTLE)}if(this._castling[l]&o.QSIDE_CASTLE){let e=this._kings[l],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(a,this._kings[l])||this._attacked(a,e-1)||this._attacked(a,t)||w(s,l,this._kings[l],t,"k",void 0,o.QSIDE_CASTLE)}}if(!e||-1===this._kings[l])return s;let p=[];for(let e=0,t=s.length;e<t;e++)this._makeMove(s[e]),this._isKingAttacked(l)||p.push(s[e]),this._undoMove();return p}move(e,{strict:t=!1}={}){let i=null;if("string"==typeof e)i=this._moveFromSan(e,t);else if("object"==typeof e){let t=this._moves();for(let r=0,n=t.length;r<n;r++)if(e.from===k(t[r].from)&&e.to===k(t[r].to)&&(!("promotion"in t[r])||e.promotion===t[r].promotion)){i=t[r];break}}if(!i){if("string"==typeof e)throw Error(`Invalid move: ${e}`);throw Error(`Invalid move: ${JSON.stringify(e)}`)}let r=new n(this,i);return this._makeMove(i),this._incPositionCount(r.after),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){let t=this._turn,i=S(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&o.EP_CAPTURE&&("b"===this._turn?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),"k"===this._board[e.to].type){if(this._kings[t]=e.to,e.flags&o.KSIDE_CASTLE){let t=e.to-1,i=e.to+1;this._board[t]=this._board[i],delete this._board[i]}else if(e.flags&o.QSIDE_CASTLE){let t=e.to+1,i=e.to-2;this._board[t]=this._board[i],delete this._board[i]}this._castling[t]=0}if(this._castling[t]){for(let i=0,r=m[t].length;i<r;i++)if(e.from===m[t][i].square&&this._castling[t]&m[t][i].flag){this._castling[t]^=m[t][i].flag;break}}if(this._castling[i]){for(let t=0,r=m[i].length;t<r;t++)if(e.to===m[i][t].square&&this._castling[i]&m[i][t].flag){this._castling[i]^=m[i][t].flag;break}}e.flags&o.BIG_PAWN?"b"===t?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=-1,"p"===e.piece?this._halfMoves=0:e.flags&(o.CAPTURE|o.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===t&&this._moveNumber++,this._turn=i}undo(){let e=this._undoMove();if(e){let t=new n(this,e);return this._decPositionCount(t.after),t}return null}_undoMove(){let e=this._history.pop();if(void 0===e)return null;let t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;let i=this._turn,r=S(i);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured){if(t.flags&o.EP_CAPTURE){let e;e="b"===i?t.to-16:t.to+16,this._board[e]={type:"p",color:r}}else this._board[t.to]={type:t.captured,color:r}}if(t.flags&(o.KSIDE_CASTLE|o.QSIDE_CASTLE)){let e,i;t.flags&o.KSIDE_CASTLE?(e=t.to+1,i=t.to-1):(e=t.to-2,i=t.to+1),this._board[e]=this._board[i],delete this._board[i]}return t}pgn({newline:e="\n",maxWidth:t=0}={}){let i=[],r=!1;for(let t in this._header)this._header[t]&&i.push(`[${t} "${this._header[t]}"]`+e),r=!0;r&&this._history.length&&i.push(e);let n=e=>{let t=this._comments[this.fen()];if(void 0!==t){let i=e.length>0?" ":"";e=`${e}${i}{${t}}`}return e},s=[];for(;this._history.length>0;)s.push(this._undoMove());let o=[],l="";for(0===s.length&&o.push(n(""));s.length>0;){l=n(l);let e=s.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(l.length&&o.push(l),l=this._moveNumber+".");else{let e=`${this._moveNumber}. ...`;l=l?`${l} ${e}`:e}l=l+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(l.length&&o.push(n(l)),o.push(this._header.Result||"*"),0===t)return i.join("")+o.join(" ");let a=function(){return i.length>0&&" "===i[i.length-1]&&(i.pop(),!0)},h=0;for(let r=0;r<o.length;r++){if(h+o[r].length>t&&o[r].includes("{")){h=function(r,n){for(let s of n.split(" "))if(s){if(r+s.length>t){for(;a();)r--;i.push(e),r=0}i.push(s),r+=s.length,i.push(" "),r++}return a()&&r--,r}(h,o[r]);continue}h+o[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(e),h=0):0!==r&&(i.push(" "),h++),i.push(o[r]),h+=o[r].length}return i.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??l[e]??null,this.getHeaders()}removeHeader(e){return e in this._header&&(this._header[e]=l[e]||null,!0)}getHeaders(){let e={};for(let[t,i]of Object.entries(this._header))null!==i&&(e[t]=i);return e}loadPgn(e,{strict:t=!1,newlineChar:i="\r?\n"}={}){function r(e){return e.replace(/\\/g,"\\")}e=e.trim();let n=RegExp("^(\\[((?:"+r(i)+")|.)*\\])((?:\\s*"+r(i)+"){2}|(?:\\s*"+r(i)+")*$)").exec(e),s=n&&n.length>=2?n[1]:"";this.reset();let o=function(e){let t={},n=e.split(new RegExp(r(i))),s="",o="";for(let e=0;e<n.length;e++){let i=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;s=n[e].replace(i,"$1"),o=n[e].replace(i,"$2"),s.trim().length>0&&(t[s]=o)}return t}(s),l="";for(let e in o)"fen"===e.toLowerCase()&&(l=o[e]),this.header(e,o[e]);if(t){if("1"===o.SetUp){if(!("FEN"in o))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}}else l&&this.load(l,{preserveHeaders:!0});let a=function(e){return e=e.replace(RegExp(r(i),"g")," "),`{${Array.from(e.slice(1,e.length-1)).map(function(e){return 128>e.charCodeAt(0)?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()}).join("")}}`},h=e.replace(s,"").replace(RegExp(`({[^}]*})+?|;([^${r(i)}]*)`,"g"),function(e,t,i){return void 0!==t?a(t):" "+a(`{${i.slice(1)}}`)}).replace(RegExp(r(i),"g")," "),u=/(\([^()]+\))+?/g;for(;u.test(h);)h=h.replace(u,"");let f=(h=(h=(h=h.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).trim().split(new RegExp(/\s+/));f=f.filter(e=>""!==e);let d="";for(let e=0;e<f.length;e++){let i=function(e){if(e.startsWith("{")&&e.endsWith("}")){var t;return 0==(t=e.slice(1,e.length-1)).length?"":decodeURIComponent("%"+(t.match(/.{1,2}/g)||[]).join("%"))}}(f[e]);if(void 0!==i){this._comments[this.fen()]=i;continue}let r=this._moveFromSan(f[e],t);if(null==r){if(v.indexOf(f[e])>-1)d=f[e];else throw Error(`Invalid move in PGN: ${f[e]}`)}else d="",this._makeMove(r),this._incPositionCount(this.fen())}d&&Object.keys(this._header).length&&this._header.Result!==d&&this.setHeader("Result",d)}_moveToSan(e,t){let i="";if(e.flags&o.KSIDE_CASTLE)i="O-O";else if(e.flags&o.QSIDE_CASTLE)i="O-O-O";else{if("p"!==e.piece){let r=function(e,t){let i=e.from,r=e.to,n=e.piece,s=0,o=0,l=0;for(let e=0,a=t.length;e<a;e++){let a=t[e].from,h=t[e].to;n===t[e].piece&&i!==a&&r===h&&(s++,i>>4==a>>4&&o++,(15&i)==(15&a)&&l++)}return s>0?o>0&&l>0?k(i):l>0?k(i).charAt(1):k(i).charAt(0):""}(e,t);i+=e.piece.toUpperCase()+r}e.flags&(o.CAPTURE|o.EP_CAPTURE)&&("p"===e.piece&&(i+=k(e.from)[0]),i+="x"),i+=k(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,t=!1){let i,r,n,s,o;let l=y(e),a=C(l),u=this._moves({legal:!0,piece:a});for(let e=0,t=u.length;e<t;e++)if(l===y(this._moveToSan(u[e],u)))return u[e];if(t)return null;let f=!1;if((r=l.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(i=r[1],n=r[2],s=r[3],o=r[4],1==n.length&&(f=!0)):(r=l.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=r[1],n=r[2],s=r[3],o=r[4],1==n.length&&(f=!0)),a=C(l),u=this._moves({legal:!0,piece:i||a}),!s)return null;for(let e=0,t=u.length;e<t;e++)if(n){if((!i||i.toLowerCase()==u[e].piece)&&h[n]==u[e].from&&h[s]==u[e].to&&(!o||o.toLowerCase()==u[e].promotion))return u[e];if(f){let t=k(u[e].from);if((!i||i.toLowerCase()==u[e].piece)&&h[s]==u[e].to&&(n==t[0]||n==t[1])&&(!o||o.toLowerCase()==u[e].promotion))return u[e]}}else if(l===y(this._moveToSan(u[e],u)).replace("x",""))return u[e];return null}ascii(){let e="   +------------------------+\n";for(let t=h.a8;t<=h.h1;t++){if(0==(15&t)&&(e+=" "+"87654321"[t>>4]+" |"),this._board[t]){let i=this._board[t].type;e+=" "+("w"===this._board[t].color?i.toUpperCase():i.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(e){let t=this._moves({legal:!1}),i=0,r=this._turn;for(let n=0,s=t.length;n<s;n++)this._makeMove(t[n]),!this._isKingAttacked(r)&&(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){let e=[],t=[];for(let i=h.a8;i<=h.h1;i++)null==this._board[i]?t.push(null):t.push({square:k(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e}squareColor(e){if(e in h){let t=h[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){let t=[],i=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){let r=t.pop();if(!r)break;e?i.push(new n(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){let t=I(e);return this._positionCount[t]||0}_incPositionCount(e){let t=I(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){let t=I(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){let e=[],t={},i=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){let t=e.pop();if(!t)break;this._makeMove(t),i(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{let t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(let i of["k","q"])void 0!==t[i]&&(t[i]?this._castling[e]|=g[i]:this._castling[e]&=~g[i]);this._updateCastlingRights();let i=this.getCastlingRights(e);return(void 0===t.k||t.k===i.k)&&(void 0===t.q||t.q===i.q)}getCastlingRights(e){return{k:(this._castling[e]&g.k)!=0,q:(this._castling[e]&g.q)!=0}}moveNumber(){return this._moveNumber}}},42200:(e,t,i)=>{i.d(t,{tG:()=>f});var r=i(99542);let n=Symbol("RESET"),s=(e,t,i)=>(t.has(i)?t:t.set(i,e())).get(i),o=new WeakMap,l=(e,t,i)=>(t.has(i)?t:t.set(i,e())).get(i),a=new WeakMap,h=e=>"function"==typeof(null==e?void 0:e.then),u=function(e=()=>{try{return window.localStorage}catch(e){"undefined"!=typeof window&&console.warn(e);return}},t){var i;let r,n,s;let o={getItem:(t,i)=>{var s,o;let l=e=>{if(r!==(e=e||"")){try{n=JSON.parse(e,void 0)}catch(e){return i}r=e}return n},a=null!=(o=null==(s=e())?void 0:s.getItem(t))?o:null;return h(a)?a.then(l):l(a)},setItem:(t,i)=>{var r;return null==(r=e())?void 0:r.setItem(t,JSON.stringify(i,void 0))},removeItem:t=>{var i;return null==(i=e())?void 0:i.removeItem(t)}};try{s=null==(i=e())?void 0:i.subscribe}catch(e){}if(!s&&"undefined"!=typeof window&&"function"==typeof window.addEventListener&&window.Storage&&(s=(t,i)=>{if(!(e()instanceof window.Storage))return()=>{};let r=r=>{r.storageArea===e()&&r.key===t&&i(r.newValue)};return window.addEventListener("storage",r),()=>{window.removeEventListener("storage",r)}}),s){let e;e=s,o.subscribe=(t,i,r)=>e(t,e=>{let t;try{t=JSON.parse(e||"")}catch(e){t=r}i(t)})}return o}();function f(e,t,i=u,s){let o=null==s?void 0:s.getOnInit,l=(0,r.eU)(o?i.getItem(e,t):t);return l.debugPrivate=!0,l.onMount=r=>{let n;return r(i.getItem(e,t)),i.subscribe&&(n=i.subscribe(e,r,t)),n},(0,r.eU)(e=>e(l),(r,s,o)=>{let a="function"==typeof o?o(r(l)):o;return a===n?(s(l,t),i.removeItem(e)):a instanceof Promise?a.then(t=>(s(l,t),i.setItem(e,t))):(s(l,a),i.setItem(e,a))})}let d=new WeakMap,_=(e,t,i)=>(t.has(i)?t:t.set(i,e())).get(i),c=new WeakMap},85278:(e,t,i)=>{i.d(t,{Xr:()=>_,fp:()=>c,md:()=>d});var r=i(14232),n=i(99542);let s=(0,r.createContext)(void 0),o=e=>{let t=(0,r.useContext)(s);return(null==e?void 0:e.store)||t||(0,n.zp)()},l=e=>"function"==typeof(null==e?void 0:e.then),a=e=>{e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t})},h=r.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw a(e),e}),u=new WeakMap,f=e=>{let t=u.get(e);return t||(t=new Promise((i,r)=>{let n=e,s=e=>t=>{n===e&&i(t)},o=e=>t=>{n===e&&r(t)},a=e=>{"onCancel"in e&&"function"==typeof e.onCancel&&e.onCancel(r=>{if(r===e)throw Error("[Bug] p is not updated even after cancelation");l(r)?(u.set(r,t),n=r,r.then(s(r),o(r)),a(r)):i(r)})};e.then(s(e),o(e)),a(e)}),u.set(e,t)),t};function d(e,t){let i=o(t),[[n,s,u],d]=(0,r.useReducer)(t=>{let r=i.get(e);return Object.is(t[0],r)&&t[1]===i&&t[2]===e?t:[r,i,e]},void 0,()=>[i.get(e),i,e]),_=n;(s!==i||u!==e)&&(d(),_=i.get(e));let c=null==t?void 0:t.delay;return((0,r.useEffect)(()=>{let t=i.sub(e,()=>{if("number"==typeof c){let t=i.get(e);l(t)&&a(f(t)),setTimeout(d,c);return}d()});return d(),t},[i,e,c]),(0,r.useDebugValue)(_),l(_))?h(f(_)):_}function _(e,t){let i=o(t);return(0,r.useCallback)((...t)=>{if(!("write"in e))throw Error("not writable atom");return i.set(e,...t)},[i,e])}function c(e,t){return[d(e,t),_(e,t)]}},99542:(e,t,i)=>{let r;i.d(t,{eU:()=>s,zp:()=>P});let n=0;function s(e,t){let i=`atom${++n}`,r={toString(){return this.debugLabel?i+":"+this.debugLabel:i}};return"function"==typeof e?r.read=e:(r.init=e,r.read=o,r.write=l),t&&(r.write=t),r}function o(e){return e(this)}function l(e,t,i){return t(this,"function"==typeof i?i(e(this)):i)}let a=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,h=e=>"init"in e,u=e=>!!e.write,f=new WeakMap,d=e=>{var t;return p(e)&&!(null==(t=f.get(e))?void 0:t[1])},_=(e,t)=>{let i=f.get(e);if(i)i[1]=!0,i[0].forEach(e=>e(t));else throw Error("[Bug] cancelable promise not found")},c=e=>{if(f.has(e))return;let t=[new Set,!1];f.set(e,t);let i=()=>{t[1]=!0};e.then(i,i),e.onCancel=e=>{t[0].add(e)}},p=e=>"function"==typeof(null==e?void 0:e.then),g=e=>"v"in e||"e"in e,m=e=>{if("e"in e)throw e.e;if(!("v"in e))throw Error("[Bug] atom state is not initialized");return e.v},b=(e,t,i)=>{i.p.has(e)||(i.p.add(e),t.then(()=>{i.p.delete(e)},()=>{i.p.delete(e)}))},v=(e,t,i,r,n)=>{var s;if(r===t)throw Error("[Bug] atom cannot depend on itself");i.d.set(r,n.n),d(i.v)&&b(t,i.v,n),null==(s=n.m)||s.t.add(t),e&&w(e,r,t)},E=()=>({D:new Map,H:new Set,M:new Set,L:new Set}),k=(e,t,i)=>{e[t].add(i)},S=(e,t,i)=>{e.D.has(t)||(e.D.set(t,new Set),k(e,"M",()=>{var t;null==(t=i.m)||t.l.forEach(t=>k(e,"M",t))}))},w=(e,t,i)=>{let r=e.D.get(t);r&&r.add(i)},C=(e,t)=>e.D.get(t),y=e=>{let t;let i=!1,r=e=>{try{e()}catch(e){i||(t=e,i=!0)}};for(;e.H.size||e.M.size||e.L.size;)e.D.clear(),e.H.forEach(r),e.H.clear(),e.M.forEach(r),e.M.clear(),e.L.forEach(r),e.L.clear();if(i)throw t},I=(...[e,t,i,r])=>{let n=(t,i,r)=>{let n="v"in i,s=i.v,o=d(i.v)?i.v:null;if(p(r)){for(let n of(c(r),i.d.keys()))b(t,r,e(n));i.v=r}else i.v=r;delete i.e,delete i.x,n&&Object.is(s,i.v)||(++i.n,o&&_(o,r))},s=(i,r)=>{var o;let l,f;let d=e(r);if(g(d)&&(d.m&&!d.x||Array.from(d.d).every(([e,t])=>s(i,e).n===t)))return d;d.d.clear();let _=!0;try{let c=t(r,t=>{if(a(r,t)){let i=e(t);if(!g(i)){if(h(t))n(t,i,t.init);else throw Error("no atom init")}return m(i)}let o=s(i,t);try{return m(o)}finally{if(_)v(i,r,d,t,o);else{let e=E();v(e,r,d,t,o),A(e,r,d),y(e)}}},{get signal(){return l||(l=new AbortController),l.signal},get setSelf(){return u(r)||console.warn("setSelf function cannot be used with read-only atom"),!f&&u(r)&&(f=(...e)=>{if(_&&console.warn("setSelf function cannot be called in sync"),!_)return w(r,...e)}),f}});if(n(r,d,c),p(c)){null==(o=c.onCancel)||o.call(c,()=>null==l?void 0:l.abort());let e=()=>{if(d.m){let e=E();A(e,r,d),y(e)}};c.then(e,e)}return d}catch(e){return delete d.v,d.e=e,delete d.x,++d.n,d}finally{_=!1}},o=(t,i,r)=>{var n,s;let o=new Map;for(let t of(null==(n=r.m)?void 0:n.t)||[]){let i=e(t);i.m&&o.set(t,i)}for(let t of r.p)o.set(t,e(t));return null==(s=C(t,i))||s.forEach(t=>{o.set(t,e(t))}),o},l=(e,t,i)=>{let r=[],n=new Set,l=new Set,a=[[t,i]];for(;a.length>0;){let[t,i]=a[a.length-1];if(l.has(t)){a.pop();continue}if(n.has(t)){r.push([t,i,i.n]),l.add(t),i.x=!0,a.pop();continue}for(let[r,s]of(n.add(t),o(e,t,i)))t===r||n.has(r)||a.push([r,s])}k(e,"H",()=>{let i=new Set([t]);for(let t=r.length-1;t>=0;--t){let[n,o,l]=r[t],a=!1;for(let e of o.d.keys())if(e!==n&&i.has(e)){a=!0;break}a&&(s(e,n),A(e,n,o),l!==o.n&&(S(e,n,o),i.add(n))),delete o.x}})},f=(t,r,...o)=>{let u=!0;try{return i(r,e=>m(s(t,e)),(i,...s)=>{let o=e(i);try{if(!a(r,i))return f(t,i,...s);{if(!h(i))throw Error("atom not writable");let e=o.n,r=s[0];n(i,o,r),A(t,i,o),e!==o.n&&(S(t,i,o),l(t,i,o));return}}finally{u||y(t)}},...o)}finally{u=!1}},w=(e,...t)=>{let i=E();try{return f(i,e,...t)}finally{y(i)}},A=(t,i,r)=>{if(r.m&&!d(r.v)){for(let n of r.d.keys())r.m.d.has(n)||(T(t,n,e(n)).t.add(i),r.m.d.add(n));for(let n of r.m.d||[])if(!r.d.has(n)){r.m.d.delete(n);let s=P(t,n,e(n));null==s||s.t.delete(i)}}},T=(t,i,n)=>{if(!n.m){for(let r of(s(t,i),n.d.keys()))T(t,r,e(r)).t.add(i);if(n.m={l:new Set,d:new Set(n.d.keys()),t:new Set},u(i)){let e;let s=n.m,o=(t,r)=>{let n=!0;e=(...e)=>{try{return f(t,i,...e)}finally{n||y(t)}};try{return r()}finally{n=!1}};k(t,"L",()=>{let n=o(t,()=>r(i,(...t)=>e(...t)));n&&(s.u=e=>o(e,n))})}}return n.m},P=(t,i,r)=>{if(r.m&&!r.m.l.size&&!Array.from(r.m.t).some(t=>{var r;return null==(r=e(t).m)?void 0:r.d.has(i)})){let n=r.m.u;for(let s of(n&&k(t,"L",()=>n(t)),delete r.m,r.d.keys())){let r=P(t,s,e(s));null==r||r.t.delete(i)}return}return r.m};return{get:e=>m(s(void 0,e)),set:w,sub:(t,i)=>{let r=E(),n=e(t),s=T(r,t,n).l;return s.add(i),y(r),()=>{s.delete(i);let e=E();P(e,t,n),y(e)}},unstable_derive:n=>I(...n(e,t,i,r))}},A=e=>{let t;let i=new WeakMap,r=new Set,n=0,s=e.unstable_derive((e,s,o,l)=>(t=e,[t=>{let n=i.get(t);return n||(n=new Proxy(e(t),{set:(e,i,n)=>("m"===i&&r.add(t),Reflect.set(e,i,n)),deleteProperty:(e,i)=>("m"===i&&r.delete(t),Reflect.deleteProperty(e,i))}),i.set(t,n)),n},s,(e,t,i,...r)=>n?i(e,...r):o(e,t,i,...r),l])),o=s.set;return Object.assign(s,{dev4_get_internal_weak_map:()=>({get:e=>{let i=t(e);if(0!==i.n)return i}}),dev4_get_mounted_atoms:()=>r,dev4_restore_atoms:e=>{o({read:()=>null,write:(t,i)=>{++n;try{for(let[t,r]of e)h(t)&&i(t,r)}finally{--n}}})}})},T=()=>{let e=new WeakMap;return A(I(t=>{if(!t)throw Error("Atom is undefined or null");let i=e.get(t);return i||(i={d:new Map,p:new Set,n:0},e.set(t,i)),i},(e,...t)=>e.read(...t),(e,...t)=>e.write(...t),(e,...t)=>{var i;return null==(i=e.onMount)?void 0:i.call(e,...t)}))},P=()=>(!r&&(r=T(),globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=r),globalThis.__JOTAI_DEFAULT_STORE__!==r&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044")),r)}}]);